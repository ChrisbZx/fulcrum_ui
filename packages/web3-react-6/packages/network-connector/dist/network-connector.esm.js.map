{"version":3,"file":"network-connector.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\r\nimport { AbstractConnector } from '@web3-react/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\nimport invariant from 'tiny-invariant'\r\n\r\ninterface NetworkConnectorArguments {\r\n  urls: { [chainId: number]: string }\r\n  defaultChainId?: number\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n}\r\n\r\nexport class NetworkConnector extends AbstractConnector {\r\n  private readonly providers: { [chainId: number]: any }\r\n  private currentChainId: number\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n  private active: boolean\r\n\r\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\r\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\r\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\r\n\r\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\r\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\r\n    }, {})\r\n    this.active = false\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    this.providers[this.currentChainId].start()\r\n    this.active = true\r\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.providers[this.currentChainId]\r\n  }\r\n\r\n  public async getChainId(): Promise<number> {\r\n    return this.currentChainId\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return null\r\n  }\r\n\r\n  public deactivate() {\r\n    this.providers[this.currentChainId].stop()\r\n    this.active = false\r\n  }\r\n\r\n  public changeChainId(chainId: number) {\r\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\r\n    if (this.active) {\r\n      this.providers[this.currentChainId].stop()\r\n      this.currentChainId = chainId\r\n      this.providers[this.currentChainId].start()\r\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\r\n    } else {\r\n      this.currentChainId = chainId\r\n    }\r\n  }\r\n}\r\n"],"names":["NetworkConnector","urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","currentChainId","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","addProvider","CacheSubprovider","RPCSubprovider","assign","active","activate","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":"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"}