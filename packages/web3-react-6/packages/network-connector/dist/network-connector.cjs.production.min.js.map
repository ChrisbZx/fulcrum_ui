{"version":3,"file":"network-connector.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\r\nimport { AbstractConnector } from '@web3-react/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\nimport invariant from 'tiny-invariant'\r\n\r\ninterface NetworkConnectorArguments {\r\n  urls: { [chainId: number]: string }\r\n  defaultChainId?: number\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n}\r\n\r\nexport class NetworkConnector extends AbstractConnector {\r\n  private readonly providers: { [chainId: number]: any }\r\n  private currentChainId: number\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n  private active: boolean\r\n\r\n  constructor({ urls, defaultChainId, pollingInterval, requestTimeoutMs }: NetworkConnectorArguments) {\r\n    invariant(defaultChainId || Object.keys(urls).length === 1, 'defaultChainId is a required argument with >1 url')\r\n    super({ supportedChainIds: Object.keys(urls).map((k): number => Number(k)) })\r\n\r\n    this.currentChainId = defaultChainId || Number(Object.keys(urls)[0])\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n    this.providers = Object.keys(urls).reduce((accumulator, chainId) => {\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(urls[Number(chainId)], this.requestTimeoutMs))\r\n      return Object.assign(accumulator, { [Number(chainId)]: engine })\r\n    }, {})\r\n    this.active = false\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    this.providers[this.currentChainId].start()\r\n    this.active = true\r\n    return { provider: this.providers[this.currentChainId], chainId: this.currentChainId, account: null }\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.providers[this.currentChainId]\r\n  }\r\n\r\n  public async getChainId(): Promise<number> {\r\n    return this.currentChainId\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return null\r\n  }\r\n\r\n  public deactivate() {\r\n    this.providers[this.currentChainId].stop()\r\n    this.active = false\r\n  }\r\n\r\n  public changeChainId(chainId: number) {\r\n    invariant(Object.keys(this.providers).includes(chainId.toString()), `No url found for chainId ${chainId}`)\r\n    if (this.active) {\r\n      this.providers[this.currentChainId].stop()\r\n      this.currentChainId = chainId\r\n      this.providers[this.currentChainId].start()\r\n      this.emitUpdate({ provider: this.providers[this.currentChainId], chainId })\r\n    } else {\r\n      this.currentChainId = chainId\r\n    }\r\n  }\r\n}\r\n"],"names":["urls","defaultChainId","pollingInterval","requestTimeoutMs","Object","keys","length","invariant","supportedChainIds","map","k","Number","currentChainId","providers","reduce","accumulator","chainId","engine","Web3ProviderEngine","_this","addProvider","CacheSubprovider","RPCSubprovider","assign","active","activate","this","start","provider","account","getProvider","getChainId","getAccount","deactivate","stop","changeChainId","includes","toString","emitUpdate","AbstractConnector"],"mappings":"sYAqBgBA,IAAAA,KAAMC,IAAAA,eAAgBC,IAAAA,gBAAiBC,IAAAA,wBACzCF,GAA+C,IAA7BG,OAAOC,KAAKL,GAAMM,QAA9CC,qBACM,CAAEC,kBAAmBJ,OAAOC,KAAKL,GAAMS,KAAI,SAACC,UAAcC,OAAOD,eAElEE,eAAiBX,GAAkBU,OAAOP,OAAOC,KAAKL,GAAM,MAC5DE,gBAAkBA,IAClBC,iBAAmBA,IACnBU,UAAYT,OAAOC,KAAKL,GAAMc,QAAO,SAACC,EAAaC,SAChDC,EAAS,IAAIC,EAAmB,CAAEhB,gBAAiBiB,EAAKjB,yBAC9De,EAAOG,YAAY,IAAIC,GACvBJ,EAAOG,YAAY,IAAIE,iBAAetB,EAAKW,OAAOK,IAAWG,EAAKhB,mBAC3DC,OAAOmB,OAAOR,UAAgBJ,OAAOK,IAAWC,QACtD,MACEO,QAAS,sHAGHC,+BACXC,KAAKb,UAALa,KAAoBd,gBAAgBe,QAApCD,KACKF,QAAS,kBACP,CAAEI,SAFTF,KAEwBb,UAFxBa,KAEuCd,gBAAiBI,QAFxDU,KAEsEd,eAAgBiB,QAAS,6CAGpFC,kDACJJ,KAAKb,UAALa,KAAoBd,uDAGhBmB,iDACJL,KAAKd,sDAGDoB,6CACJ,SAGFC,WAAA,gBACApB,UAAUa,KAAKd,gBAAgBsB,YAC/BV,QAAS,KAGTW,cAAA,SAAcnB,GACTZ,OAAOC,KAAKqB,KAAKb,WAAWuB,SAASpB,EAAQqB,aAAvD9B,MACImB,KAAKF,aACFX,UAAUa,KAAKd,gBAAgBsB,YAC/BtB,eAAiBI,OACjBH,UAAUa,KAAKd,gBAAgBe,aAC/BW,WAAW,CAAEV,SAAUF,KAAKb,UAAUa,KAAKd,gBAAiBI,QAAAA,UAE5DJ,eAAiBI,MAtDUuB"}