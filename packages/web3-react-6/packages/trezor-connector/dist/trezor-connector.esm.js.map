{"version":3,"file":"trezor-connector.esm.js","sources":["../src/index.ts"],"sourcesContent":["import { ConnectorUpdate } from '@web3-react/types'\r\nimport { AbstractConnector } from '@web3-react/abstract-connector'\r\nimport Web3ProviderEngine from 'web3-provider-engine'\r\nimport { TrezorSubprovider } from '@0x/subproviders/lib/src/subproviders/trezor' // https://github.com/0xProject/0x-monorepo/issues/1400\r\nimport CacheSubprovider from 'web3-provider-engine/subproviders/cache.js'\r\nimport { RPCSubprovider } from '@0x/subproviders/lib/src/subproviders/rpc_subprovider' // https://github.com/0xProject/0x-monorepo/issues/1400\r\n\r\ninterface TrezorConnectorArguments {\r\n  chainId: number\r\n  url: string\r\n  pollingInterval?: number\r\n  requestTimeoutMs?: number\r\n  config?: any\r\n  manifestEmail: string\r\n  manifestAppUrl: string\r\n}\r\n\r\nexport class TrezorConnector extends AbstractConnector {\r\n  private readonly chainId: number\r\n  private readonly url: string\r\n  private readonly pollingInterval?: number\r\n  private readonly requestTimeoutMs?: number\r\n  private readonly config: any\r\n  private readonly manifestEmail: string\r\n  private readonly manifestAppUrl: string\r\n\r\n  private provider: any\r\n\r\n  constructor({\r\n    chainId,\r\n    url,\r\n    pollingInterval,\r\n    requestTimeoutMs,\r\n    config = {},\r\n    manifestEmail,\r\n    manifestAppUrl\r\n  }: TrezorConnectorArguments) {\r\n    super({ supportedChainIds: [chainId] })\r\n\r\n    this.chainId = chainId\r\n    this.url = url\r\n    this.pollingInterval = pollingInterval\r\n    this.requestTimeoutMs = requestTimeoutMs\r\n    this.config = config\r\n    this.manifestEmail = manifestEmail\r\n    this.manifestAppUrl = manifestAppUrl\r\n  }\r\n\r\n  public async activate(): Promise<ConnectorUpdate> {\r\n    if (!this.provider) {\r\n      const { default: TrezorConnect } = await import('trezor-connect')\r\n      TrezorConnect.manifest({\r\n        email: this.manifestEmail,\r\n        appUrl: this.manifestAppUrl\r\n      })\r\n      const engine = new Web3ProviderEngine({ pollingInterval: this.pollingInterval })\r\n      engine.addProvider(new TrezorSubprovider({ trezorConnectClientApi: TrezorConnect, ...this.config }))\r\n      engine.addProvider(new CacheSubprovider())\r\n      engine.addProvider(new RPCSubprovider(this.url, this.requestTimeoutMs))\r\n      this.provider = engine\r\n    }\r\n\r\n    this.provider.start()\r\n\r\n    return { provider: this.provider, chainId: this.chainId }\r\n  }\r\n\r\n  public async getProvider(): Promise<Web3ProviderEngine> {\r\n    return this.provider\r\n  }\r\n\r\n  public async getChainId(): Promise<number> {\r\n    return this.chainId\r\n  }\r\n\r\n  public async getAccount(): Promise<null> {\r\n    return this.provider._providers[0].getAccountsAsync(1).then((accounts: string[]): string => accounts[0])\r\n  }\r\n\r\n  public deactivate() {\r\n    this.provider.stop()\r\n  }\r\n}\r\n"],"names":["TrezorConnector","chainId","url","pollingInterval","requestTimeoutMs","config","manifestEmail","manifestAppUrl","supportedChainIds","activate","provider","start","TrezorConnect","manifest","email","appUrl","engine","Web3ProviderEngine","addProvider","TrezorSubprovider","trezorConnectClientApi","CacheSubprovider","RPCSubprovider","getProvider","getChainId","getAccount","_providers","getAccountsAsync","then","accounts","deactivate","stop","AbstractConnector"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAiBaA,eAAb;AAAA;;AAWE;;;QACEC,eAAAA;QACAC,WAAAA;QACAC,uBAAAA;QACAC,wBAAAA;2BACAC;QAAAA,kCAAS;QACTC,qBAAAA;QACAC,sBAAAA;AAEA,0CAAM;AAAEC,MAAAA,iBAAiB,EAAE,CAACP,OAAD;AAArB,KAAN;AAEA,UAAKA,OAAL,GAAeA,OAAf;AACA,UAAKC,GAAL,GAAWA,GAAX;AACA,UAAKC,eAAL,GAAuBA,eAAvB;AACA,UAAKC,gBAAL,GAAwBA,gBAAxB;AACA,UAAKC,MAAL,GAAcA,MAAd;AACA,UAAKC,aAAL,GAAqBA,aAArB;AACA,UAAKC,cAAL,GAAsBA,cAAtB;;AACD;;AA7BH;;AAAA,SA+BeE,QA/Bf;AAAA;;AA6CI,eAAKC,QAAL,CAAcC,KAAd;;AAEA,eAAO;AAAED,UAAAA,QAAQ,EAAE,OAAKA,QAAjB;AAA2BT,UAAAA,OAAO,EAAE,OAAKA;AAAzC,SAAP;;;mBAfK;;;YAAD,CAAC,OAAKS;iCACiC,OAAO,gBAAP;gBAAxBE;AACjBA,YAAAA,aAAa,CAACC,QAAd,CAAuB;AACrBC,cAAAA,KAAK,EAAE,OAAKR,aADS;AAErBS,cAAAA,MAAM,EAAE,OAAKR;AAFQ,aAAvB;AAIA,gBAAMS,MAAM,GAAG,IAAIC,kBAAJ,CAAuB;AAAEd,cAAAA,eAAe,EAAE,OAAKA;AAAxB,aAAvB,CAAf;AACAa,YAAAA,MAAM,CAACE,WAAP,CAAmB,IAAIC,iBAAJ;AAAwBC,cAAAA,sBAAsB,EAAER;AAAhD,eAAkE,OAAKP,MAAvE,EAAnB;AACAW,YAAAA,MAAM,CAACE,WAAP,CAAmB,IAAIG,gBAAJ,EAAnB;AACAL,YAAAA,MAAM,CAACE,WAAP,CAAmB,IAAII,cAAJ,CAAmB,OAAKpB,GAAxB,EAA6B,OAAKE,gBAAlC,CAAnB;AACA,mBAAKM,QAAL,GAAgBM,MAAhB;;;;;;AAMH,KAhDH;AAAA;AAAA;AAAA;;AAAA,SAkDeO,WAlDf;AAAA;mBAmDW;;AAAP,6BAAO,OAAKb,QAAZ;AACD,KApDH;AAAA;AAAA;AAAA;;AAAA,SAsDec,UAtDf;AAAA;mBAuDW;;AAAP,6BAAO,OAAKvB,OAAZ;AACD,KAxDH;AAAA;AAAA;AAAA;;AAAA,SA0DewB,UA1Df;AAAA;mBA2DW;;AAAP,6BAAO,OAAKf,QAAL,CAAcgB,UAAd,CAAyB,CAAzB,EAA4BC,gBAA5B,CAA6C,CAA7C,EAAgDC,IAAhD,CAAqD,UAACC,QAAD;AAAA,eAAgCA,QAAQ,CAAC,CAAD,CAAxC;AAAA,OAArD,CAAP;AACD,KA5DH;AAAA;AAAA;AAAA;;AAAA,SA8DSC,UA9DT,GA8DS;AACL,SAAKpB,QAAL,CAAcqB,IAAd;AACD,GAhEH;;AAAA;AAAA,EAAqCC,iBAArC;;;;"}